<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Jadwal Sport Flashscore Style</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg-main: #f7f7f7;
      --bg-card: #fff;
      --bg-accent: #f1f3f6;
      --bg-hover: #e3eaf3;
      --border: #d1d5db;
      --text-main: #222;
      --text-muted: #666;
      --accent: #1976d2;
      --tab-bg: #f1f3f6;
      --tab-active: #fff;
      --tab-border: #d1d5db;
      --radius: 12px;
    }
    body {
      background: var(--bg-main);
      color: var(--text-main);
      font-family: 'Segoe UI', Arial, Roboto, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 8px 32px 8px;
    }
    .header-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0;
      padding: 18px 0 0 0;
    }
    .sports-tabs {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      border-bottom: 1px solid var(--border);
      padding-bottom: 8px;
      margin: 0;
      flex: 1;
    }
    .sport-btn {
      background: var(--tab-bg);
      border: 1px solid var(--tab-border);
      border-bottom: none;
      border-radius: 7px 7px 0 0;
      color: var(--text-main);
      font-size: 1rem;
      font-weight: 500;
      padding: 8px 18px;
      cursor: pointer;
      outline: none;
      transition: background 0.2s, color 0.2s;
      min-width: 80px;
      white-space: nowrap;
    }
    .sport-btn.active {
      background: var(--tab-active);
      color: var(--accent);
      font-weight: 600;
      border-bottom: 2px solid var(--accent);
    }
    .dark-toggle-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      margin-left: 12px;
      color: var(--text-muted);
      transition: color 0.2s;
    }
    .dark-toggle-btn:hover {
      color: var(--accent);
    }
    .accordion {
      margin-bottom: 18px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--bg-card);
      overflow: hidden;
      transition: background 0.3s;
    }
    .accordion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      padding: 14px 18px;
      background: var(--bg-accent);
      font-size: 1.08rem;
      font-weight: 600;
      border-bottom: 1px solid var(--border);
      user-select: none;
      transition: background 0.2s;
    }
    .accordion-header:hover, .accordion-header:active {
      background: var(--bg-hover);
    }
    .league-icon {
      font-size: 1.5rem;
      margin-right: 10px;
      flex-shrink: 0;
      display: inline-block;
      vertical-align: middle;
    }
    .accordion-title {
      font-weight: bold;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .accordion-arrow {
      font-size: 1.2em;
      transition: transform 0.3s;
      margin-left: 10px;
      color: var(--text-muted);
    }
    .accordion.expanded .accordion-arrow {
      transform: rotate(90deg);
    }
    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s cubic-bezier(.4,0,.2,1), padding 0.3s;
      background: var(--bg-card);
      padding: 0 18px;
    }
    .accordion.expanded .accordion-content {
      padding: 14px 18px 18px 18px;
      max-height: 1200px;
    }
    .league-table-wrap {
      width: 100%;
      overflow-x: auto;
    }
    table.league-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--bg-card);
      font-size: 0.98rem;
      min-width: 420px;
    }
    table.league-table th, table.league-table td {
      padding: 8px 6px;
      text-align: center;
      border-bottom: 1px solid var(--border);
      font-weight: 400;
      color: var(--text-main);
    }
    table.league-table th {
      background: var(--bg-accent);
      font-weight: 600;
      color: var(--text-muted);
      font-size: 0.97rem;
      letter-spacing: 0.5px;
    }
    table.league-table tr {
      background: var(--bg-card);
      transition: background 0.2s;
    }
    table.league-table tr:hover {
      background: var(--bg-hover);
    }
    .bet-btn {
      background: var(--tab-bg);
      color: var(--accent);
      border: none;
      border-radius: 4px;
      padding: 6px 16px;
      font-size: 0.97rem;
      font-weight: 700;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.2s, color 0.2s;
      display: inline-block;
    }
    .bet-btn:hover, .bet-btn:focus {
      background: var(--accent);
      color: #fff;
    }
    .error-msg {
      color: #d32f2f;
      background: #fff0f0;
      border: 1px solid #f5c2c7;
      border-radius: 6px;
      padding: 18px;
      text-align: center;
      margin: 32px 0;
      font-weight: 500;
    }
    .loader {
      text-align: center;
      color: var(--text-muted);
      padding: 32px 0;
      font-size: 1.1rem;
    }
    /* Dark mode */
    .dark-mode {
      --bg-main: #181a20;
      --bg-card: #23252b;
      --bg-accent: #23252b;
      --bg-hover: #222c36;
      --border: #333a45;
      --text-main: #fff;
      --text-muted: #b0b0b0;
      --accent: #90caf9;
      --tab-bg: #23252b;
      --tab-active: #181a20;
      --tab-border: #333a45;
    }
    .dark-mode .error-msg {
      background: #2d1a1a;
      color: #ffb4b4;
      border-color: #a33;
    }
    .dark-mode .bet-btn {
      color: #90caf9;
      background: #263859;
    }
    .dark-mode .bet-btn:hover, .dark-mode .bet-btn:focus {
      background: #1976d2;
      color: #fff;
    }
    @media (max-width: 700px) {
      .container {
        max-width: 100vw;
        padding: 0 2px 24px 2px;
      }
      .sports-tabs {
        font-size: 0.97rem;
        gap: 4px;
      }
      .sport-btn {
        padding: 7px 10px;
        font-size: 0.97rem;
        min-width: 60px;
      }
      .accordion-header {
        font-size: 1rem;
        padding: 11px 10px;
      }
      .accordion-content {
        padding: 0 10px;
      }
      .accordion.expanded .accordion-content {
        padding: 10px 10px 14px 10px;
      }
      table.league-table th, table.league-table td {
        padding: 6px 2px;
        font-size: 0.95rem;
      }
      .bet-btn {
        padding: 5px 10px;
        font-size: 0.95rem;
      }
    }
    @media (max-width: 480px) {
      table.league-table {
        min-width: 320px;
        font-size: 0.93rem;
      }
      .league-table-wrap {
        padding: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-bar">
      <div class="sports-tabs" id="sports-tabs"></div>
      <button class="dark-toggle-btn" id="dark-toggle" title="Toggle dark mode">ğŸŒ™</button>
    </div>
    <div id="main-content"></div>
  </div>
  <script>
    // Ganti URL_API sesuai endpoint Anda
    const URL_API = 'https://script.google.com/macros/s/AKfycbzoIifvsbqAcfiVvBhNdYsUqSGpu2AwpD2CntfeTseVk8rKatfOJ9pXCH0e4Ox1U1hU-A/exec';

    // Kategori olahraga + emoji
    const SPORTS = [
      { key: 'bola', label: 'Bola', emoji: 'âš½' },
      { key: 'basket', label: 'Basket', emoji: 'ğŸ€' },
      { key: 'tennis', label: 'Tennis', emoji: 'ğŸ¾' },
      { key: 'voli', label: 'Voli', emoji: 'ğŸ' },
      { key: 'badminton', label: 'Badminton', emoji: 'ğŸ¸' },
      { key: 'baseball', label: 'Baseball', emoji: 'âš¾' },
      { key: 'esport', label: 'Esports', emoji: 'ğŸ®' }
    ];

    // Mapping bendera negara super lengkap (ISO + populer), fallback ğŸ†
    function getLigaIcon(liga) {
      if (!liga) return "ğŸ†";
      liga = liga.toLowerCase();
      // Partial mapping, extend for all ISO country names/codes
      if (liga.includes("argentina")) return "ğŸ‡¦ğŸ‡·";
      if (liga.includes("brazil")) return "ğŸ‡§ğŸ‡·";
      if (liga.includes("ecuador")) return "ğŸ‡ªğŸ‡¨";
      if (liga.includes("chile")) return "ğŸ‡¨ğŸ‡±";
      if (liga.includes("peru")) return "ğŸ‡µğŸ‡ª";
      if (liga.includes("uruguay")) return "ğŸ‡ºğŸ‡¾";
      if (liga.includes("colombia")) return "ğŸ‡¨ğŸ‡´";
      if (liga.includes("venezuela")) return "ğŸ‡»ğŸ‡ª";
      if (liga.includes("paraguay")) return "ğŸ‡µğŸ‡¾";
      if (liga.includes("bolivia")) return "ğŸ‡§ğŸ‡´";
      if (liga.includes("mexico")) return "ğŸ‡²ğŸ‡½";
      if (liga.includes("usa") || liga.includes("united states")) return "ğŸ‡ºğŸ‡¸";
      if (liga.includes("canada")) return "ğŸ‡¨ğŸ‡¦";
      if (liga.includes("spain")) return "ğŸ‡ªğŸ‡¸";
      if (liga.includes("france")) return "ğŸ‡«ğŸ‡·";
      if (liga.includes("italy")) return "ğŸ‡®ğŸ‡¹";
      if (liga.includes("germany")) return "ğŸ‡©ğŸ‡ª";
      if (liga.includes("portugal")) return "ğŸ‡µğŸ‡¹";
      if (liga.includes("netherlands")) return "ğŸ‡³ğŸ‡±";
      if (liga.includes("belgium")) return "ğŸ‡§ğŸ‡ª";
      if (liga.includes("switzerland")) return "ğŸ‡¨ğŸ‡­";
      if (liga.includes("austria")) return "ğŸ‡¦ğŸ‡¹";
      if (liga.includes("england") || liga.includes("premier league")) return "ğŸ´";
      if (liga.includes("scotland")) return "ğŸ´";
      if (liga.includes("ireland")) return "ğŸ‡®ğŸ‡ª";
      if (liga.includes("norway")) return "ğŸ‡³ğŸ‡´";
      if (liga.includes("sweden")) return "ğŸ‡¸ğŸ‡ª";
      if (liga.includes("denmark")) return "ğŸ‡©ğŸ‡°";
      if (liga.includes("finland")) return "ğŸ‡«ğŸ‡®";
      if (liga.includes("russia")) return "ğŸ‡·ğŸ‡º";
      if (liga.includes("ukraine")) return "ğŸ‡ºğŸ‡¦";
      if (liga.includes("poland")) return "ğŸ‡µğŸ‡±";
      if (liga.includes("czech")) return "ğŸ‡¨ğŸ‡¿";
      if (liga.includes("slovakia")) return "ğŸ‡¸ğŸ‡°";
      if (liga.includes("serbia")) return "ğŸ‡·ğŸ‡¸";
      if (liga.includes("croatia")) return "ğŸ‡­ğŸ‡·";
      if (liga.includes("slovenia")) return "ğŸ‡¸ğŸ‡®";
      if (liga.includes("greece")) return "ğŸ‡¬ğŸ‡·";
      if (liga.includes("turkey")) return "ğŸ‡¹ğŸ‡·";
      if (liga.includes("romania")) return "ğŸ‡·ğŸ‡´";
      if (liga.includes("bulgaria")) return "ğŸ‡§ğŸ‡¬";
      if (liga.includes("hungary")) return "ğŸ‡­ğŸ‡º";
      if (liga.includes("israel")) return "ğŸ‡®ğŸ‡±";
      if (liga.includes("egypt")) return "ğŸ‡ªğŸ‡¬";
      if (liga.includes("morocco")) return "ğŸ‡²ğŸ‡¦";
      if (liga.includes("algeria")) return "ğŸ‡©ğŸ‡¿";
      if (liga.includes("saudi arabia")) return "ğŸ‡¸ğŸ‡¦";
      if (liga.includes("qatar")) return "ğŸ‡¶ğŸ‡¦";
      if (liga.includes("uae") || liga.includes("united arab emirates")) return "ğŸ‡¦ğŸ‡ª";
      if (liga.includes("china")) return "ğŸ‡¨ğŸ‡³";
      if (liga.includes("japan")) return "ğŸ‡¯ğŸ‡µ";
      if (liga.includes("south korea")) return "ğŸ‡°ğŸ‡·";
      if (liga.includes("vietnam")) return "ğŸ‡»ğŸ‡³";
      if (liga.includes("thailand")) return "ğŸ‡¹ğŸ‡­";
      if (liga.includes("indonesia")) return "ğŸ‡®ğŸ‡©";
      if (liga.includes("malaysia")) return "ğŸ‡²ğŸ‡¾";
      if (liga.includes("singapore")) return "ğŸ‡¸ğŸ‡¬";
      if (liga.includes("philippines")) return "ğŸ‡µğŸ‡­";
      if (liga.includes("taiwan")) return "ğŸ‡¹ğŸ‡¼";
      if (liga.includes("india")) return "ğŸ‡®ğŸ‡³";
      if (liga.includes("australia")) return "ğŸ‡¦ğŸ‡º";
      if (liga.includes("new zealand")) return "ğŸ‡³ğŸ‡¿";
      if (liga.includes("world") || liga.includes("champions league") || liga.includes("europa league") || liga.includes("asean") || liga.includes("asia")) return "ğŸŒ";
      // Extend: All ISO country names/codes (add more as needed)
      // Fallback
      return "ğŸ†";
    }

    // Escape HTML
    function escapeHTML(str) {
      return String(str || '').replace(/[&<>"']/g, function(m) {
        return ({'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'})[m];
      });
    }

    // Render tabs kategori olahraga
    function renderSportsTabs(activeSport) {
      const tabs = document.getElementById('sports-tabs');
      tabs.innerHTML = '';
      SPORTS.forEach(sport => {
        const btn = document.createElement('button');
        btn.className = 'sport-btn' + (sport.key === activeSport ? ' active' : '');
        btn.textContent = sport.emoji + ' ' + sport.label;
        btn.onclick = () => {
          if (window.currentSport !== sport.key) {
            window.currentSport = sport.key;
            renderSportsTabs(sport.key);
            fetchAndRenderLeagues(sport.key);
          }
        };
        tabs.appendChild(btn);
      });
    }

    // Loader
    function showLoader() {
      document.getElementById('main-content').innerHTML =
        '<div class="loader">Memuat jadwal...</div>';
    }

    // Error
    function showError(msg) {
      document.getElementById('main-content').innerHTML =
        `<div class="error-msg">${msg}</div>`;
    }

    // Render liga dan pertandingan
    function renderLeagues(ligaMap, sportKey) {
      const main = document.getElementById('main-content');
      main.innerHTML = '';
      if (!ligaMap || Object.keys(ligaMap).length === 0) {
        main.innerHTML = '<div class="error-msg">Tidak ada jadwal tersedia.</div>';
        return;
      }
      Object.entries(ligaMap).forEach(([liga, matches], idx) => {
        // Accordion
        const accordion = document.createElement('div');
        accordion.className = 'accordion' + (idx === 0 ? ' expanded' : '');

        // Header
        const header = document.createElement('div');
        header.className = 'accordion-header';
        header.innerHTML = `
          <span class="accordion-title">
            <span class="league-icon">${getLigaIcon(liga)}</span>
            <b>${escapeHTML(liga)}</b>
          </span>
          <span class="accordion-arrow">&#9654;</span>`;
        header.onclick = () => {
          accordion.classList.toggle('expanded');
        };

        // Content
        const content = document.createElement('div');
        content.className = 'accordion-content';

        // Table
        const tableWrap = document.createElement('div');
        tableWrap.className = 'league-table-wrap';
        const table = document.createElement('table');
        table.className = 'league-table';

        // Esport: cek jika sportKey === 'esport'
        let isEsport = sportKey === 'esport';

        // Table header
        table.innerHTML = `
          <thead>
            <tr>
              <th>Tanggal</th>
              <th>Jam</th>
              <th>Home</th>
              <th>Away</th>
              ${isEsport ? '<th>Skor</th>' : ''}
              <th>BET</th>
            </tr>
          </thead>
          <tbody>
            ${matches.map(m => `
              <tr>
                <td>${escapeHTML(m.tanggal)}</td>
                <td>${escapeHTML(m.jam)}</td>
                <td>${escapeHTML(isEsport ? m.tima : m.tima || m.home)}</td>
                <td>${escapeHTML(isEsport ? m.timb : m.timb || m.away)}</td>
                ${isEsport ? `<td>${escapeHTML(m.skor || '-')}</td>` : ''}
                <td>
                  <a class="bet-btn" href="${m.linkbet || '#'}" target="_blank" rel="noopener">BET</a>
                </td>
              </tr>
            `).join('')}
          </tbody>
        `;
        tableWrap.appendChild(table);
        content.appendChild(tableWrap);

        accordion.appendChild(header);
        accordion.appendChild(content);
        main.appendChild(accordion);
      });
    }

    // Fetch data dari API dan group by liga
    async function fetchAndRenderLeagues(sportKey) {
      showLoader();
      try {
        const res = await fetch(URL_API + '?sport=' + encodeURIComponent(sportKey));
        if (!res.ok) throw new Error('Gagal fetch');
        const jadwal = await res.json();

        // Group by liga
        const ligaMap = {};
        if (sportKey === 'esport') {
          // Gabung game + turnamen jadi nama liga
          jadwal.forEach(j => {
            if (!j.game || !j.turnamen || !j.tanggal || !j.jam || !j.tima || !j.timb || !j.linkbet) return;
            const ligaName = j.game + ' - ' + j.turnamen;
            if (!ligaMap[ligaName]) ligaMap[ligaName] = [];
            ligaMap[ligaName].push(j);
          });
        } else {
          jadwal.forEach(j => {
            // Support format tima/timb (untuk sheet yang pakai tima/timb)
            if (!j.liga || !j.tanggal || !j.jam || !(j.tima || j.home) || !(j.timb || j.away) || !j.linkbet) return;
            if (!ligaMap[j.liga]) ligaMap[j.liga] = [];
            ligaMap[j.liga].push(j);
          });
        }

        // Sort jadwal per liga by tanggal & jam
        Object.values(ligaMap).forEach(arr => {
          arr.sort((a, b) => {
            let tglA = (a.tanggal || '').replace(/(\d{2})\/(\d{2})\/(\d{4})/, '$3-$2-$1');
            let tglB = (b.tanggal || '').replace(/(\d{2})\/(\d{2})\/(\d{4})/, '$3-$2-$1');
            let dateA = new Date(tglA + ' ' + (a.jam || ''));
            let dateB = new Date(tglB + ' ' + (b.jam || ''));
            return dateA - dateB;
          });
        });

        renderLeagues(ligaMap, sportKey);
      } catch (e) {
        showError('Gagal mengambil data, silakan refresh.');
      }
    }

    // Dark mode toggle
    const darkToggleBtn = document.getElementById('dark-toggle');
    darkToggleBtn.onclick = function() {
      document.body.classList.toggle('dark-mode');
      darkToggleBtn.textContent = document.body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ğŸŒ™';
    };

    // Inisialisasi
    window.currentSport = SPORTS[0].key;
    renderSportsTabs(window.currentSport);
    fetchAndRenderLeagues(window.currentSport);

    // Touch support for accordion (optional, for mobile)
    document.addEventListener('touchstart', function(){}, {passive:true});
  </script>
</body>
</html>
